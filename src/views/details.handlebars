<div class="container my-5 text-white">
    <div class="row align-items-center">
        <div class="col-md-6">
            <img src="https://files.cdn.printful.com/o/upload/bfl-image/42/11354_l_t-shirt-Design-Examples-mockup_Art-with-text.png" class="img-fluid rounded-3 card-custom" alt="{{product.title}}">
        </div>
        <div class="col-md-6 ">
            <div class="p-4 bg-dark rounded-3">
                <h1 class="display-5">{{product.title}}</h1>
                <p class="fst-italic">Categoría: {{product.category}}</p>
                <p>{{product.description}}</p>
                <div class="mb-3">
                    <span class="badge" style="background: linear-gradient(to right, #6a11cb, #2575fc);">Stock: {{product.stock}}</span>
                </div>
                <div class="row align-items-center">
                    <button id="addToCartBtn" class="btn btn-outline-primary col-4" data-product-id="{{product.id}}">Añadir al
                        carrito</button>
                    <h2 class="col-8 text-end fw-light">Precio: ${{product.price}}</h2>
                </div>
            </div>
        </div>
        <a href="/products" class="btn btn-primary mt-3">Volver a la lista</a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const addToCartBtn = document.getElementById('addToCartBtn');
    const cartContent = document.getElementById('cart-content'); // Elemento para mostrar la cantidad de productos en el carrito
    

    addToCartBtn.addEventListener('click', function () {
        const userId = "a69867dc9cfc7062dfd112e7"
        const productTitle = addToCartBtn.dataset.title;
        const productId = addToCartBtn.dataset.productId; // Obtener productId del dataset
        fetch('/add-to-cart/' + productId, { // Enviar la solicitud POST al endpoint correcto
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ product_id: productId, user_id: userId, title: productTitle })
        })
        .then(response => {
            if (response.ok) {
                alert('Producto añadido al carrito');
                // Actualizar contador del carrito
                updateCartCounter();
            } else {
                alert('Error al añadir el producto al carrito');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });

    // Función para actualizar el contador del carrito
    function updateCartCounter() {
        // Realizar una solicitud GET al servidor para obtener la cantidad de productos en el carrito
        fetch('/cart')
            .then(response => response.json())
            .then(cartItems => {
                const cartItemCount = cartItems.length;
                cartContent.textContent = cartItemCount; // Actualizar el texto del contador del carrito
            })
            .catch(error => console.error('Error al obtener el carrito:', error));
    }
});
</script>
